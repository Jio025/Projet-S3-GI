<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="http://localhost:8180/js/keycloak.js"></script>
    <script>
        var keycloak;
        function initKeycloak() {
            keycloak = new Keycloak({
                "realm": "usager",
                "auth-server-url": "http://localhost:8180/",
                "ssl-required": "external",
                "clientId": "frontend",
                "public-client": true,
                "confidential-port": 0
            });
            keycloak.init({onLoad: 'login-required'}).then(function (authenticated) {
                alert(authenticated ? 'authenticated' : 'not authenticated');

            }).catch(function () {
                alert('failed to initialize');
            });
        }


        function requestStudent() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            axios.get("http://localhost:8888/api/student", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response.status);
                    span.innerHTML = '<br> <strong>' + response.data.cip + '</strong> </br>' +
                        '<br> <strong>' + response.data.last_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.first_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.email + '</strong> </br>' +
                        '<br> <strong>' + response.data.roles + '</strong> </br>'
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
            span.innerHTML = '<br> <strong>' + "Vous n'avez pas le role d'étudiant" + '</strong> </br>'
        }

        function requestTeacher() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            axios.get("http://localhost:8888/api/teacher", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response.status);
                    span.innerHTML = '<br> <strong>' + response.data.cip + '</strong> </br>' +
                        '<br> <strong>' + response.data.last_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.first_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.email + '</strong> </br>' +
                        '<br> <strong>' + response.data.roles + '</strong> </br>'
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
            span.innerHTML = '<br> <strong>' + "Vous n'avez pas le role d'enseignant" + '</strong> </br>'
        }

        function requestMessage() {
            const div = document.getElementById('title');
            const span = div.firstElementChild;
            axios.get("http://localhost:8888/api/getmessages/e24/s3i/app2", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response.status);
                    span.innerHTML = '';
                    for (let i in response.data) {
                        console.log(response.data[i]);
                        span.innerHTML +=
                            '<br> <strong>' + response.data[i].cip + '</strong>' +
                            '<br> <strong>' + response.data[i].description + '</strong> </br>'
                    }
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
            span.innerHTML = '<br> <strong>' + "Aucun message" + '</strong> </br>'
        }

                function toggleButtons(folderId) {
                const hiddenButtons = document.getElementById(folderId);
                if (hiddenButtons.style.display === 'none') {
                hiddenButtons.style.display = 'block';
            } else {
                hiddenButtons.style.display = 'none';
            }
            }

        function showMessage(letter) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.innerHTML = 'Tu as cliqué sur le bouton ' + letter;
        }
        function logout() {
         //   let logoutURL = "http://localhost:8080//realms/usager/protocol/openid-connect/logout"
         //   window.location.href = logoutURL;
        }
        function requestDockerfile(dockerfileID){
            // Make the API call with the Keycloak token
            axios.get(`http://localhost:8888/api/getDockerfile/${dockerfileID}`, {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function(response) {
                    console.log("Response:", response.status);
                    const textarea = document.getElementById("dockerfileOutput");
                    // Display the returned message
                    textarea.innerHTML = `${response.data}`;
                })
                .catch(function(error) {
                    console.error(error);
                    const textarea = document.getElementById("dockerfileOutput");
                    textarea.innerHTML = 'Failed to fetch message or unauthorized';
                });
        }

    </script>
</head>
<body onload="initKeycloak()">


<button onclick="toggleButtons('folder1')">Session 1 GEGIGRO</button>
<button onclick="toggleButtons('folder2')">Session 2 GEGI</button>
<button onclick="toggleButtons('folder3')">Session 3 GI</button>

<div id="folder1" style="display:none;">
    <button onclick="requestDockerfile('S1APP1SN')">APP1-SN</button>
    <button onclick="showMessage('S1-APP1-TETITO')">APP1-TETITO</button>
    <button onclick="showMessage('S1-APP2-SN')">APP2-SN</button>
    <button onclick="showMessage('S1-APP2-TO')">APP2-TO</button>
    <button onclick="showMessage('S1APP3')">APP3</button>
    <button onclick="showMessage('S1APP4')">APP4</button>
    <button onclick="showMessage('S1APP5a')">APP5a</button>
    <button onclick="showMessage('S1APP5b')">APP5b</button>
    <button onclick="showMessage('S1APP6')">APP6</button>
</div>

<div id="folder2" style="display:none;">
    <button onclick="showMessage('S2APP1')">APP1</button>
    <button onclick="showMessage('S2APP2')">APP2</button>
    <button onclick="showMessage('S2APP3-GE')">APP3-GE</button>
    <button onclick="showMessage('S2APP3-GI')">APP3-GI</button>
    <button onclick="showMessage('S2APP4')">APP4</button>
    <button onclick="showMessage('S2APP5-GE')">APP5-GE</button>
    <button onclick="showMessage('S2APP5-GI')">APP5-GI</button>
    <button onclick="showMessage('S2APP6')">APP6</button>
    <button onclick="showMessage('S2APP7-GE')">APP7-GE</button>
    <button onclick="showMessage('S2APP7-GI')">APP7-GI</button>
</div>

<div id="folder3" style="display:none;">
    <button onclick="showMessage('S3APP1')">APP1</button>
    <button onclick="showMessage('S3APP2')">APP2</button>
    <button onclick="showMessage('S3APP3')">APP3</button>
    <button onclick="showMessage('S3APP4')">APP4</button>
    <button onclick="showMessage('S3APP5')">APP5</button>
    <button onclick="showMessage('S3APP6')">APP6</button>
</div>

<div id="textarea">
    <label>
    <textarea id="dockerfileOutput" rows="20" cols="80" readonly></textarea>
    </label>
</div>

<p id="messageContainer"></p>

<div id="title">
    <span></span>
</div>
</body>
</html>
